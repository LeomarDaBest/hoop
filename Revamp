local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "Perfect Hoop Auto Shoot",
   Icon = 0,
   LoadingTitle = "Auto Shoot",
   LoadingSubtitle = "by Author",
   Theme = "Default",
   ConfigurationSaving = {
      Enabled = true,
      FileName = "AutoShootHoop"
   },
   KeySystem = false
})

local Tab = Window:CreateTab("Shooting", 4483362458)
Tab:CreateSection("Shooting Features")

local AutoShootEnabled = false
local AutoPowerEnabled = false

local Player = game.Players.LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
local Camera = workspace.CurrentCamera
local VirtualInputManager = game:GetService("VirtualInputManager")

local function IsHoldingBasketball()
    local Basketball = Character:FindFirstChild("Basketball")
    return Basketball and Basketball:FindFirstChild("Ball")
end

local function GetGoal()
    local Distance, Goal = math.huge, nil
    local CharacterPosition = Character.PrimaryPart.Position
    for _, container in ipairs({workspace:FindFirstChild("Courts"), workspace:FindFirstChild("PracticeArea")}) do
        if container then
            for _, court in ipairs(container:GetChildren()) do
                for _, Obj in ipairs(court:GetDescendants()) do
                    if Obj.Name == "Swish" and Obj.Parent:FindFirstChildOfClass("TouchTransmitter") then
                        local Magnitude = (CharacterPosition - Obj.Parent.Position).Magnitude
                        if Magnitude < Distance then
                            Distance, Goal = Magnitude, Obj.Parent
                        end
                    end
                end
            end
        end
    end
    return Goal, Distance
end

-- Improved function to calculate power based on distance to hoop
local function SetAutoPower(Distance)
    local Power = nil
    if Distance >= 60 then Power = 75 end
    if Distance >= 50 and Distance < 60 then Power = 70 end
    if Distance >= 40 and Distance < 50 then Power = 60 end
    if Distance >= 30 and Distance < 40 then Power = 50 end
    if Distance >= 20 and Distance < 30 then Power = 40 end
    if Distance < 20 then Power = 30 end
    if Power then Player:SetAttribute("Power", Power) end
end

-- Function to ensure the shot is made directly inside the hoop
local function AimAndShootAtHoop()
    local Goal, Distance = GetGoal()
    if Goal and IsHoldingBasketball() then
        SetAutoPower(Distance)

        -- Aim directly at the center of the hoop and adjust for a high arc
        local targetPos = Goal.Position + Vector3.new(0, 3, 0)  -- Slightly above the hoop center
        local angleAdjustment = Vector3.new(0, math.clamp(Distance / 100, 2, 3), 0)  -- High arc for longer shots

        -- Position camera to align the shot
        local originalCF = Camera.CFrame
        Camera.CFrame = CFrame.new(Camera.CFrame.Position, targetPos + angleAdjustment)
        task.wait(0.05)

        -- Simulate the shot with the calculated power
        VirtualInputManager:SendTouchEvent(1, Enum.UserInputState.Begin.Value, 355, 70)
        task.wait(0.01)
        VirtualInputManager:SendTouchEvent(1, Enum.UserInputState.End.Value, 355, 70)
        task.wait(0.05)

        -- Reset camera position
        Camera.CFrame = originalCF
    end
end

-- Detect when jumping and trigger auto-shoot
local Humanoid = Character:WaitForChild("Humanoid")
Humanoid.StateChanged:Connect(function(_, NewState)
    if AutoShootEnabled and NewState == Enum.HumanoidStateType.Jumping then
        task.wait(0.3)
        AimAndShootAtHoop()
    end
end)

-- UI to toggle Auto Shoot
Tab:CreateToggle({
   Name = "Auto Shoot on Jump",
   CurrentValue = false,
   Flag = "AutoShoot",
   Callback = function(Value)
       AutoShootEnabled = Value
   end
})

-- UI to toggle Auto Power
Tab:CreateToggle({
   Name = "Auto Power",
   CurrentValue = false,
   Flag = "AutoPower",
   Callback = function(Value)
       AutoPowerEnabled = Value
   end
})
